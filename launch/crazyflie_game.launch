<?xml version="1.0"?>

<launch>

  <!-- arguments -->
  <arg name="uri" default="radio://0/84/1M/E7E7E7E703" />
  <arg name="world_frame" default="/world" />
  <arg name="all_cf_frames" default="cf4 cf5 cf3" />
  <arg name="cf_frame" default="cf3" />
  <arg name="player_id" default="I"/>
  <arg name="v" default=".4"/>
  <arg name="server" default="192.168.2.230" />
  <arg name="port" default="3883" />

  <!-- start crazyflie_client -->
  <include file="$(find crazyflie_driver)/launch/crazyflie_server.launch">
  </include>

  <!-- run vrpn client -->
  <include file="$(find optitrack_broadcast)/launch/optitrack_broadcast_p300.launch">
    <arg name="server" value="$(arg server)" />
    <arg name="frames" value="$(arg all_cf_frames)" />
  </include>

  <!-- the first crazyflie -->
  <group ns='cf3'>
    <!-- initiate services -->
    <!-- <node name="services" pkg="crazyflie_game" type="services.py" output="screen">
    </node> -->

    <!-- add crazyflie -->
    <include file="$(find crazyflie_driver)/launch/crazyflie_add.launch">
      <arg name="uri" value="$(arg uri)" />
      <arg name="tf_prefix" value="$(arg cf_frame)" />
      <arg name="enable_logging" value="True" />
    </include>

    <!-- add inner-loop controller -->
    <include file="$(find crazyflie_controller)/launch/crazyflie2.launch">
      <arg name="frame" value="$(arg cf_frame)" />
    </include>

    <!-- add outer-loop controller, hover only for now -->
    <include file="$(find crazyflie_game)/launch/game_controller.launch">
      <arg name="player_id" value="$(arg player_id)"/>
      <arg name="velocity" value="$(arg v)"/>
      <arg name="goal_topic" value="/$(arg cf_frame)/goal" />
      <arg name="cmdV_topic" value="/$(arg cf_frame)/cmdV" />
      <arg name="world_frame" value="/world" />
      <arg name="cf_frame" value="$(arg cf_frame)" />
    </include>
    
    <!-- add plotter -->
    <include file="$(find crazyflie_game)/launch/data_recorder.launch">
      <arg name="goal_topic" value="/$(arg cf_frame)/goal" />
      <arg name="mcap_topic" value="/$(arg cf_frame)/mocap"/>
      <arg name="cmdV_topic" value="/$(arg cf_frame)/cmdV" />
      <arg name="cmd_vel_topic" value="/$(arg cf_frame)/cmd_vel" />
      <arg name="cmdVtemp_topic" value="/$(arg cf_frame)/cmdVtemp" />
      <arg name="cf_frame" value="$(arg cf_frame)" />
    </include>
  </group>



</launch>